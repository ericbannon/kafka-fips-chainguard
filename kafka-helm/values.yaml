# If your cluster needs pull secrets:
# global:
#   imagePullSecrets:
#     - your-regcred

clusterDomain: cluster.local
usePasswordFiles: true

# --- Image (optional override; defaults already point at Chainguard private repo) ---
image:
  registry: 452336408843.dkr.ecr.us-west-2.amazonaws.com
  repository: kafka
  tag: iamguarded-cg
  pullPolicy: Always
# --- KRaft layout ---
# 3 controllers (IDs start at controller.minId=0)
# 3 brokers (IDs start at broker.minId=100)
controller:
  controllerOnly: true
  replicaCount: 3
  minId: 0
  persistence:
    enabled: true
    storageClass: gp2-csi
    size: 5Gi

broker:
  replicaCount: 3
  minId: 100
  persistence:
    enabled: true
    storageClass: gp2-csi
    size: 5Gi

# --- Listeners (SSL everywhere; no SASL) ---
listeners:
  client:
    protocol: SSL
  interbroker:
    protocol: SSL
  controller:
    protocol: SSL
  external:
    protocol: SSL

# --- TLS (JKS from existing secrets) ---
tls:
  type: JKS
  autoGenerated:
    enabled: false

  # Secret must contain:
  # - kafka.truststore.jks
  # - and either:
  #   * kafka.keystore.jks (single keystore for all nodes) OR
  #   * per-node keystores:
  #       kafka-controller-0.keystore.jks, kafka-controller-1.keystore.jks, kafka-controller-2.keystore.jks
  #       kafka-broker-0.keystore.jks,     kafka-broker-1.keystore.jks,     kafka-broker-2.keystore.jks
  existingSecret: kafka-jks

  # Secret must contain keys (default names):
  # - keystore-password
  # - truststore-password
  passwordsSecret: kafka-tls-passwords
  passwordsSecretKeystoreKey: keystore-password
  passwordsSecretTruststoreKey: truststore-password

# --- SASL off (since listeners are SSL, not SASL_SSL / SASL_PLAINTEXT) ---
sasl:
  existingSecret: ""

# If you want these topic settings, prefer overrideConfiguration/config style,
# but keeping extra config is fine if chart supports it via config/overrideConfiguration.
# If you previously used "extraConfig" on Bitnami, translate to this:
overrideConfiguration:
  controller.quorum.bootstrap.servers: >-
    kafka-controller-0.kafka-controller-headless.kafka.svc.cluster.local:9093,
    kafka-controller-1.kafka-controller-headless.kafka.svc.cluster.local:9093,
    kafka-controller-2.kafka-controller-headless.kafka.svc.cluster.local:9093
  ssl.endpoint.identification.algorithm: https
  offsets.topic.replication.factor: 3
  transaction.state.log.replication.factor: 3
  transaction.state.log.min.isr: 2
  min.insync.replicas: 2